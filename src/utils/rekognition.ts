import {
  CompareFacesCommand,
  RekognitionClient,
} from '@aws-sdk/client-rekognition';

import { REGION } from '../libs/s3Client';

const photo_source = 'Image.jpg';
const photo_target = 'IMG-3692.jpg';
//const photo_target = 'person.jpg';
//const photo_target =
// 'data:image/jpeg;base64,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Pz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNi4wLjAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmV4aWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vZXhpZi8xLjAvIiB4bWxuczpwaG90b3Nob3A9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGhvdG9zaG9wLzEuMC8iIHhtcDpDcmVhdGVEYXRlPSIyMDIyLTEwLTEzVDE4OjI5OjAyLjE2MSIgeG1wOkNyZWF0b3JUb29sPSIxNi4wIiB4bXA6TW9kaWZ5RGF0ZT0iMjAyMi0xMC0xM1QxODoyOTowMiIgZXhpZjpDb21wb3NpdGVJbWFnZT0iMiIgcGhvdG9zaG9wOkRhdGVDcmVhdGVkPSIyMDIyLTEwLTEzVDE4OjI5OjAyLjE2MSIvPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDw/eHBhY2tldCBlbmQ9InciPz4A/+0AeFBob3Rvc2hvcCAzLjAAOEJJTQQEAAAAAAA/HAFaAAMbJUccAgAAAgACHAI/AAYxODI5MDIcAj4ACDIwMjIxMDEzHAI3AAgyMDIyMTAxMxwCPAAGMTgyOTAyADhCSU0EJQAAAAAAEK+FYqJrTlRQzIaC4c93S0n/4gIoSUNDX1BST0ZJTEUAAQEAAAIYYXBwbAQAAABtbnRyUkdCIFhZWiAH5gABAAEAAAAAAABhY3NwQVBQTAAAAABBUFBMAAAAAAAAAAAAAAAAAAAAAAAA9tYAAQAAAADTLWFwcGzs/aOOOIVHw220vU962hgvAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAApkZXNjAAAA/AAAADBjcHJ0AAABLAAAAFB3dHB0AAABfAAAABRyWFlaAAABkAAAABRnWFlaAAABpAAAABRiWFlaAAABuAAAABRyVFJDAAABzAAAACBjaGFkAAAB7AAAACxiVFJDAAABzAAAACBnVFJDAAABzAAAACBtbHVjAAAAAAAAAAEAAAAMZW5VUwAAABQAAAAcAEQAaQBzAHAAbABhAHkAIABQADNtbHVjAAAAAAAAAAEAAAAMZW5VUwAAADQAAAAcAEMAbwBwAHkAcgBpAGcAaAB0ACAAQQBwAHAAbABlACAASQBuAGMALgAsACAAMgAwADIAMlhZWiAAAAAAAAD21QABAAAAANMsWFlaIAAAAAAAAIPfAAA9v';

const client = new RekognitionClient({ region: REGION });

const params = (image1, image2) => ({
  SourceImage: {
    S3Object: {
      Bucket: process.env.S3_BUCKET,
      Name: image1,
    },
  },
  TargetImage: {
    // Bytes: blob,
    S3Object: {
      Bucket: process.env.S3_BUCKET,
      Name: image2,
    },
  },
  SimilarityThreshold: 70,
});

export const compareFaces = async () => {
  console.log(params);
  const command = new CompareFacesCommand(params(photo_source, photo_target));
  try {
    const data = await client.send(command);

    let faceMatch;
    if (data.FaceMatches.length > 0) {
      faceMatch = {
        confidence: data.FaceMatches[0].Similarity,
      };
    } else {
      faceMatch = {
        confidence: 0,
      };
    }
    return faceMatch;
  } catch (err) {
    console.log(err);
  }
};
